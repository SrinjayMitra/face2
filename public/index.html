<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Face API + WebView Token</title>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-T7W25D703G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-T7W25D703G');
</script>
<!-- <script
  src="https://js.sentry-cdn.com/92bffc0f1bc2f94d85c6a093649b8b88.min.js"
  crossorigin="anonymous"
></script> -->
<!-- <script src="https://js.sentry-cdn.com/92bffc0f1bc2f94d85c6a093649b8b88.min.js" crossorigin="anonymous"></script> --
<script>
  // Initialize Sentry
  Sentry.init({
    dsn: "https://92bffc0f1bc2f94d85c6a093649b8b88@o4510226646564864.ingest.us.sentry.io/4510226648924160",
    integrations: [
      // Automatically send all console logs, warnings, errors
      Sentry.consoleLoggingIntegration({ levels: ["log", "warn", "error"] })
    ],
    _experiments: { enableLogs: true },
    beforeSend(event) {
      // Ignore adblock or noisy errors
      if (event.exception && event.exception.values) {
        const blocked = event.exception.values.some(e =>
          e.value.includes("net::ERR_BLOCKED_BY_CLIENT")
        );
        if (blocked) return null;
      }
      return event;
    }
  });

  // Override console methods to capture all logs
  ["log", "warn", "error"].forEach(level => {
    const original = console[level];
    console[level] = function (...args) {
      Sentry.captureMessage(args.map(a => (typeof a === "object" ? JSON.stringify(a) : a)).join(" "), level);
      original.apply(console, args);
    };
  });

  console.log("Sentry is capturing all console.logs, warnings, and errors!");
</script> -->
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: sans-serif;
    }

    /* Video section with border */
    #video-section {
      position: relative;
      width: 90%;
      height: 50vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      border: 3px solid #ffcc00;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.4);
      margin-top: 10px;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1.05); /* Mirror effect */
      border-radius: 12px;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 12px;
    }

    /* Direction text + arrow overlay */
    #direction-text {
      position: absolute;
      top: 8%;
      width: 100%;
      text-align: center;
      font-size: 1.6rem;
      color: #ffcc00;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255, 204, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      z-index: 5;
    }

    /* Arrow animation */
    .arrow {
      display: inline-block;
      font-size: 1.8rem;
      animation: bounce 1s ease-in-out infinite alternate;
    }

    @keyframes bounce {
      from { transform: translateY(0); }
      to { transform: translateY(-8px); }
    }

    /* Gallery section below video */
    #gallery {
      width: 100%;
      background: #1a1a1a;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px 0;
    }

    #gallery h2 {
      margin: 4px 0;
      font-size: 1rem;
      color: #ffcc00;
    }

    #gallery-images {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 5px;
      padding-bottom: 6px;
    }

    #gallery-images img {
      width: 65px;
      height: 65px;
      border-radius: 6px;
      object-fit: cover;
      border: 2px solid #ffcc00;
      box-shadow: 0 0 8px rgba(255, 204, 0, 0.3);
    }
    /* Live console log container */
    #log-container {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      background: rgba(0,0,0,0.85);
      color: #ffcc00;
      font-family: monospace;
      font-size: 12px;
      padding: 4px;
      box-sizing: border-box;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div id="video-section">
    <video id="video-feed" autoplay muted playsinline ></video>
    <canvas id="canvas"></canvas>
    <div id="direction-text">
      <span id="direction-label">Look Center</span>
      <span id="direction-arrow" class="arrow">⬆️</span>
    </div>
  </div>

  <div id="gallery">
    <h2>Captured Faces</h2>
    <div id="gallery-images"></div>
  </div>

  <div id="log-container"></div>

  <!-- Face API library -->
  <script src="./face-api.min.js"></script>
  <!-- Custom scripts -->
  <script src="./scripts.js"></script>

  <!-- WebView token listener -->
  <script>
       function logToScreen(level, ...args) {
      const container = document.getElementById("log-container");
      if (!container) return;
      const msg = args.map(a => (typeof a === "object" ? JSON.stringify(a) : a)).join(" ");
      const line = document.createElement("div");
      line.textContent = `[${level.toUpperCase()}] ${msg}`;
      if(level === "error") line.style.color = "red";
      if(level === "warn") line.style.color = "orange";
      container.appendChild(line);
      container.scrollTop = container.scrollHeight;
    }

    ["log", "warn", "error"].forEach(level => {
      const original = console[level];
      console[level] = function(...args) {
        logToScreen(level, ...args);
        original.apply(console, args);
      };
    });

    console.log("Console logging is now visible on screen!");

  window.addEventListener("message", async (event) => {
    try {
      const data = JSON.parse(event.data);
      const token = data.accessToken;

      console.log("Received data from WebView:", JSON.stringify(data, null, 2));
      console.log("\n");
      console.log("Received token from WebView:", token);

      console.log("User Info:", JSON.stringify(data.user, null, 2));



   const response = await fetch(
        "https://inyourspace.tech/api/auth/signup",
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json", // required for JSON body
          // Authorization: `Bearer ${token}`, // uncomment if you need to send token
        },
        body: JSON.stringify({
          fullName: "abhey_LAUDE",
          username: "LAUDE_user_2",
          password: "LAUDEpassword_2",
        }),
      }
    );

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.json();
      console.log("Backend data:", result);

    } catch (err) {
      console.error("Error handling token or fetching data:", err.message);
      console.log(err.message);
    }
  });
</script>

</body>
</html>
